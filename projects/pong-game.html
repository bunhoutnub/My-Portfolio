<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pong Game</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background-color: #1a1a1a;
        font-family: "Courier", monospace;
      }
      canvas {
        border: 2px solid #333;
        display: block;
      }
    </style>
  </head>
  <body>
    <canvas id="pongCanvas" width="800" height="600"></canvas>

    <script>
      const canvas = document.getElementById("pongCanvas");
      const ctx = canvas.getContext("2d");

      // Paddle class
      class Paddle {
        constructor(x, y) {
          this.x = x;
          this.y = y;
          this.width = 20; // stretch_len=1 * 20
          this.height = 100; // stretch_wid=5 * 20
          this.color = "red";
        }

        draw() {
          ctx.fillStyle = this.color;
          ctx.fillRect(
            this.x - this.width / 2,
            this.y - this.height / 2,
            this.width,
            this.height
          );
        }

        goUp() {
          this.y -= 20;
          if (this.y - this.height / 2 < 0) {
            this.y = this.height / 2;
          }
        }

        goDown() {
          this.y += 20;
          if (this.y + this.height / 2 > 600) {
            this.y = 600 - this.height / 2;
          }
        }
      }

      // Ball class
      class Ball {
        constructor() {
          this.x = 400;
          this.y = 300;
          this.radius = 10;
          this.color = "white";
          this.xMove = 5;
          this.yMove = 5;
          this.moveSpeed = 0.016;
        }

        draw() {
          ctx.fillStyle = this.color;
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
          ctx.fill();
        }

        move() {
          this.x += this.xMove;
          this.y += this.yMove;
        }

        bounceY() {
          this.yMove *= -1;
        }

        bounceX() {
          this.xMove *= -1;
          this.moveSpeed *= 0.9;
        }

        distance(paddle) {
          const dx = this.x - paddle.x;
          const dy = this.y - paddle.y;
          return Math.sqrt(dx * dx + dy * dy);
        }

        resetPosition() {
          this.x = 400;
          this.y = 300;
          this.bounceX();
        }
      }

      // Scoreboard class
      class Scoreboard {
        constructor() {
          this.lScore = 0;
          this.rScore = 0;
        }

        draw() {
          ctx.fillStyle = "white";
          ctx.font = "80px Courier";
          ctx.textAlign = "center";
          ctx.fillText(this.lScore, 300, 280);
          ctx.fillText(this.rScore, 500, 280);
        }

        lPoint() {
          this.lScore += 1;
        }

        rPoint() {
          this.rScore += 1;
        }
      }

      // Create game objects
      const rPaddle = new Paddle(750, 300);
      const lPaddle = new Paddle(50, 300);
      const ball = new Ball();
      const scoreboard = new Scoreboard();

      // Keyboard controls
      const keys = {};
      window.addEventListener("keydown", (e) => {
        keys[e.key] = true;
      });
      window.addEventListener("keyup", (e) => {
        keys[e.key] = false;
      });

      // Game loop
      let lastTime = 0;
      let accumulator = 0;

      function gameLoop(currentTime) {
        const deltaTime = (currentTime - lastTime) / 1000;
        lastTime = currentTime;
        accumulator += deltaTime;

        // Handle input
        if (keys["ArrowUp"]) {
          rPaddle.goUp();
        }
        if (keys["ArrowDown"]) {
          rPaddle.goDown();
        }
        if (keys["w"] || keys["W"]) {
          lPaddle.goUp();
        }
        if (keys["s"] || keys["S"]) {
          lPaddle.goDown();
        }

        // Update game at fixed time step
        if (accumulator >= ball.moveSpeed) {
          accumulator = 0;

          // Move ball
          ball.move();

          // Detect collision with wall
          if (ball.y > 580 || ball.y < 20) {
            ball.bounceY();
          }

          // Detect collision with paddles
          if (
            ball.x - ball.radius <= lPaddle.x + lPaddle.width / 2 &&
            ball.x + ball.radius >= lPaddle.x - lPaddle.width / 2 &&
            ball.y >= lPaddle.y - lPaddle.height / 2 &&
            ball.y <= lPaddle.y + lPaddle.height / 2
          ) {
            ball.bounceX();
            ball.x = lPaddle.x + lPaddle.width / 2 + ball.radius;
          }

          if (
            ball.x + ball.radius >= rPaddle.x - rPaddle.width / 2 &&
            ball.x - ball.radius <= rPaddle.x + rPaddle.width / 2 &&
            ball.y >= rPaddle.y - rPaddle.height / 2 &&
            ball.y <= rPaddle.y + rPaddle.height / 2
          ) {
            ball.bounceX();
            ball.x = rPaddle.x - rPaddle.width / 2 - ball.radius;
          }

          // Detect when r_paddle misses
          if (ball.x > 780) {
            ball.resetPosition();
            scoreboard.lPoint();
          }

          // Detect when l_paddle misses
          if (ball.x < 20) {
            ball.resetPosition();
            scoreboard.rPoint();
          }
        }

        // Draw everything
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        lPaddle.draw();
        rPaddle.draw();
        ball.draw();
        scoreboard.draw();

        requestAnimationFrame(gameLoop);
      }

      // Start game
      requestAnimationFrame(gameLoop);
    </script>
  </body>
</html>
